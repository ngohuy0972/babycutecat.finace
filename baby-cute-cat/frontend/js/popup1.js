(()=>{var Z={customer_touchpoints:"",discount_font_color:"#000000",email_cta_label:"Continue",sms_cta_label:"Continue",cta_background_color:"#000000",popup_background_color:"#FFFFFF",popup_background_opacity:100,popup_logo_size:75,popup_logo_position:"top",display_type:"mobile_two_step",include_pages:[],exclude_pages:[]},i={FIXED_AMOUNT_DISCOUNT:"fixed_amount",FREE_SHIPPING_DISCOUNT:"free_shipping",PERCENT_DISCOUNT:"percent",CUSTOM:"custom",SECONDS_DELAY:"seconds",IMMEDIATELY_TIMING:"immediately",DELAY_TIMING:"delay",STORAGE_PREFIX:"popups_",SESSION_PREFIX:"popups_sessioned_",SESSION_KEY:"popup_session",SESSION_EXPIRES:30*60*1e3},A={mobile_two_step:{displays:["mobile"],steps:2},mobile_one_step:{displays:["mobile"]},desktop:{displays:["desktop"]},mobile_and_desktop:{displays:["mobile","desktop"]}},J=setInterval(()=>{document.readyState=="complete"&&(Q(),clearInterval(J))},500);function Q(){W(),ee()}function W(){popup=[];let e=document.getElementsByTagName("script");for(let t=0;t<e.length;t++)if(~e[t].src.indexOf("/emotive-popup/")){script=e[t];break}oe(),te()}function se(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function U(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))?"mobile":"desktop"}function ae(e){var t=U(),a=A[e.display_type];return a&&~a.displays.indexOf(t)}function ie(e){var t=e.include_pages.length||e.exclude_pages.length;return t?ne(e,window.location.href):!(~window.location.pathname.indexOf("cart")||~window.location.pathname.indexOf("checkout"))}function re(e){return window.localStorage.getItem(`${i.STORAGE_PREFIX}${e}`)=="true"}function le(e){let t=window.localStorage.getItem(`${i.SESSION_PREFIX}${e}`),a=window.localStorage.getItem(i.SESSION_KEY);if(Date.now()-Number(a)>i.SESSION_EXPIRES){let s=Object.keys(window.localStorage);for(let o=0;o<s.length;o++)~s[o].indexOf(i.SESSION_PREFIX)&&window.localStorage.removeItem(s[o]);return O(!0),!1}else return t=="true"}function N(e){return e&&{}.toString.call(e)==="[object Function]"}function C(){let e=null;if(script.src){e=script.src;let t=e.split("?"),a=t[1].split("&"),s={};for(let o=0;o<a.length;o++){let n=a[o].split("=");s[n[0]]=n[1]}return s.hasOwnProperty("api")||(t=e.split("/"),s.api=t[0]+"//"+t[2]),s.hasOwnProperty("brand")||(console.warn("No brand ID specified"),s.brand=null),s}}function M(){return C().brand}function q(){return window.location.origin+"/"}function $(){let e=C().api;return e.substr(e.length-1)!=="/"&&(e+="/"),e}function ce(){return script.src?script.src.split("?")[0].split("/").slice(0,-1).join("/")+"/":""}function ue(e,t){switch(e){case i.FIXED_AMOUNT_DISCOUNT:return`$${t} OFF`;case i.FREE_SHIPPING_DISCOUNT:return"FREE SHIPPING";case i.PERCENT_DISCOUNT:default:return`${t}% OFF`}}function Y(e){e.classList.add("show-up")}function P(e){e.classList.add("remove-popup"),setTimeout(()=>{e.classList.remove("show-up","remove-popup")},500)}function O(e){let t=window.localStorage.getItem(i.SESSION_KEY);(Date.now()-t<=i.SESSION_EXPIRES||e)&&window.localStorage.setItem(i.SESSION_KEY,Date.now())}function te(){O(),["mousemove","scroll","keydown","click","touchstart"].forEach(e=>document.body.addEventListener(e,O)),window.addEventListener("popup:draw",e=>z(e.detail))}function de(e,t,a){e.querySelector(".close-button").addEventListener("click",()=>{P(e),window.localStorage.setItem(`${i.SESSION_PREFIX}${t}`,!0)});let s=e.querySelector(".form-email-button");if(s){let n=e.querySelector(".input-email");s.addEventListener("click",()=>{if(se(n.value))T(`${$()}subscriber_engine/api/v1/email-subscribe/`,"post",{subscriber_source:t,email:n.value},{headers:{"Content-type":"application/json;charset=UTF-8"}}),n.classList.remove("error");else{n.classList.add("error");return}a?(e.querySelector(".forms").classList.add("transition"),e.querySelector(".forms").style.transform="translateX(calc(-100% - 20pt))"):(window.localStorage.setItem(`${STORAGE_PREFIX}${t}`,!0),P(e))})}let o=e.querySelector(".form-sms-button");o&&o.addEventListener("click",()=>{if(!o.classList.contains("busy")&&!o.classList.contains("done")){if(o.classList.add("busy"),o.innerHTML='<div class="loader"></span>',~["mobile_and_desktop","mobile_one_step","desktop"].indexOf(e.popup.display_type)){let n=e.querySelector(".input-phone-number");T(`${$()}subscriber_engineapi/opt_in_user/`,"post",{brand_id:M(),cell_number:n.value,_subscriber_engine_source_type:"EMOTIVE_POPUP",api_key:e.popup.subscribe_identifier},{headers:{"Content-type":"application/json;charset=UTF-8"}},r=>{o.classList.add("done",r?"error":"success"),o.innerHTML="Thanks for subscribing! We sent you a text!",o.classList.remove("busy")});return}else window.open(a,"_blank").focus();window.localStorage.setItem(`${i.STORAGE_PREFIX}${t}`,!0),P(e)}})}function oe(){let e=document.getElementsByTagName("head")[0];[`${ce()}popup.css`,"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css","https://fonts.googleapis.com/css?family=Roboto"].forEach(t=>{let a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.href=t,a.media="all",e.appendChild(a)})}function X(e,t){Object.keys(t).forEach(a=>{e[a]=t[a]})}function pe(e){return`00${Math.floor(255*e/100).toString(16).toUpperCase()}`.substr(-2)}function me(e){return typeof e!="object"?"":Object.keys(e).map(t=>`${t}: ${e[t]};`).join("")}function fe(e){var t=U(),a=A[e.display_type];let s=e.id,o=e.customer_touchpoints,n=e.discount,r=e.discount_type,c=e.discount_custom,p=e.link,b=e.mobile_templates,m=e.name,y=`${e.popup_background_color}${pe(e.popup_background_opacity)}`,g=e.popup_logo,x=e.timing_delay_amount,H=e.timing_delay_type,B=e.timing_type,_=document.createElement("div");_.popup=e,popup.push(_),_.classList.add("popup",b,`device-${t}`);var w=l=>l?` class="${typeof l=="string"?l:l.filter(d=>typeof d=="string").join(" ")}"`:"",u=({className:l,style:d},k)=>`<div${w(l)} style="${me(d)}">${k.join("")}</div>`,h=({className:l},d)=>`<span${w(l)}>${(d||[]).join("")}</span>`,L=({className:l},d)=>`<button${w(["button btn btn-dark",l])} style="background-color: ${e.cta_background_color}">${d.join("")}</button>`,F=(l,d)=>`<a target="_blank" href=${l}>${d.join("")}</a>`,j=({className:l,placeholder:d,value:k})=>`<input${w(l)} type="text" placeholder="${d||""}" value="${k||""}" />`,E=u({className:`logo ${e.popup_logo_position}`},[g?`<img src="${g}" style="width: ${e.popup_logo_size}%" alt="${m}" />`:""]),R=h({className:"sms-disclaimer"},[`
      By signing up via text, you agree to receive recurring automated promotional and
      personalized marketing text messages(e.g.cart reminders) at the cell number used when
      signing up. Consent is not a condition of any purchase. Reply STOP to cancel. Msg
      frequency varies. Msg and data rates may apply.
    `,h({},["View "]),F(`${q()}policies/terms-of-service`,["TERMS"]),h({},[" and "]),F(`${q()}policies/privacy-policy`,["PRIVACY POLICY"]),h({},["."])]),D=r===i.FREE_SHIPPING_DISCOUNT,v=r===i.CUSTOM,S=a.steps||1,f=[[]],K=L({className:"form-sms-button"},[e.sms_cta_label]),V=L({className:"form-email-button"},[e.email_cta_label]);~o.indexOf("email")&&(f[0].push(j({className:"input-field input-email",placeholder:"Your email"})),S>1&&f[0].push(V)),~o.indexOf("sms")&&p&&(S>1?(f.push([]),f[1].push(R)):f[0].push(j({className:"input-field input-phone-number",placeholder:"Your phone number"}))),f[f.length-1].push(K),~o.indexOf("sms")&&p&&S===1&&f[0].push(R),_.innerHTML=u({className:"popup-container",style:{"background-color":y}},[h({className:["close-button","fa","fa-times"]}),u({className:"center-content"},[u({className:"content"},[e.popup_logo_position==="top"?E:"",u({className:"discount",style:{color:e.discount_font_color}},[u({className:`head ${D&&"d-none"} ${v&&"d-none"}`},["Unlock"]),u({className:`numbers ${v&&"d-none"}`},[ue(r,n)]),u({className:["foot",D&&"d-none",v&&"d-none"]},["Your order"]),u({className:[v&&"custom-incentive",!v&&"d-none"]},[c&&c.replace(/(\r\n|\n|\r)\1/gm,"<br>")]),e.popup_logo_position==="middle"?E:""])]),u({className:"forms"},[...f.map(l=>u({className:"step"},l))]),e.popup_logo_position==="bottom"?E:""])]),document.body.appendChild(_);let I=null;switch(H){case i.SECONDS_DELAY:I=x*1e3;break;default:I=x}switch(B){case i.DELAY_TIMING:setTimeout(()=>Y(_),I);break;case i.IMMEDIATELY_TIMING:default:Y(_)}de(_,s,p)}function T(e,t,a,s,o){let n=new XMLHttpRequest,r=new URL(e);if(s&&typeof s=="object"){let c=s.queryParams,p=s.headers;if(c&&typeof c=="object"&&Object.keys(c).length>0){let b=Object.keys(c);for(let m=0;m<b.length;m++){let y=b[m],g=c[y];r.searchParams.set(y,g)}}if(n.open(t.toUpperCase(),r,!0),p&&typeof p=="object"&&Object.keys(p).length>0){let b=Object.keys(p);for(let m=0;m<b.length;m++){let y=b[m],g=p[y];n.setRequestHeader(y,g)}}}else n.open(t.toUpperCase(),r,!0);n.responseType="json",n.send(JSON.stringify(a)),n.onload=function(){if(n.status>=400){N(o)&&o(new Error(n.statusText));return}var c=n.response;s&&N(s)?s(c):o&&N(o)&&o(null,c)}}function ee(){T(`${$()}subscriber_engine/api/v1/popups/?brand_id=${M()}`,"get",null,e=>{try{_e(e)}catch(t){console.error(t)}})}function G(e,t){switch(e.cond){case"equals_to":return t===e.url;case"starts_with":return t.substr(0,e.url.length)===e.url;case"ends_with":return t.substr(-e.url.length)===e.url;case"contains":return t.indexOf(e.url)>=0;default:return!1}}function ne(e,t){var a=e.exclude_pages.filter(r=>!!r.url),s=e.include_pages.filter(r=>!!r.url),o=a.reduce((r,c)=>r||G(c,t),!1);if(o)return!1;if(!s.length)return!0;var n=s.reduce((r,c)=>r||G(c,t),!1);return n}function _e(e){if(!e||!Array.isArray(e)){console.log("[emotive] No popups found for rendering");return}var t=e[0];z(t)}function z(e){if(!e){console.log("[emotive] No popups found for rendering");return}var t={};X(t,Z),X(t,e),t&&ae(t)&&ie(t)&&!re(t.id)&&!le(t.id)&&fe(t)}})();
//# sourceMappingURL=popup.js.map
